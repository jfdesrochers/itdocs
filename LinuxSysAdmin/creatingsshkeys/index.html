



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="IT Docs - Notes from my adventures in IT">
      
      
        <link rel="canonical" href="https://jfdesrochers.github.io/itdocs/LinuxSysAdmin/creatingsshkeys/">
      
      
        <meta name="author" content="Jean-Francois Desrochers">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.3">
    
    
      
        <title>Creating and setting up a SSH key - IT Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.8d40d89b.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#creating-and-setting-up-a-ssh-key" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://jfdesrochers.github.io/itdocs" title="IT Docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                IT Docs
              </span>
              <span class="md-header-nav__topic">
                Creating and setting up a SSH key
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    IT Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Welcome" class="md-nav__link">
      Welcome
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      LinuxSysAdmin
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        LinuxSysAdmin
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Creating and setting up a SSH key
      </label>
    
    <a href="./" title="Creating and setting up a SSH key" class="md-nav__link md-nav__link--active">
      Creating and setting up a SSH key
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-create-a-rsa-key-pair" title="1 - Create a RSA key pair" class="md-nav__link">
    1 - Create a RSA key pair
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-copying-your-key-to-the-server" title="2 - Copying your key to the server" class="md-nav__link">
    2 - Copying your key to the server
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-ssh-copy-id" title="Using ssh-copy-id" class="md-nav__link">
    Using ssh-copy-id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copying-the-key-manually" title="Copying the key manually" class="md-nav__link">
    Copying the key manually
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-testing-the-password-less-authentication" title="3 - Testing the password-less authentication" class="md-nav__link">
    3 - Testing the password-less authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-disabling-password-based-authentication" title="4 - Disabling password-based authentication" class="md-nav__link">
    4 - Disabling password-based authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-creating-an-alias-to-accelerate-the-connection" title="5 - Creating an alias to accelerate the connection" class="md-nav__link">
    5 - Creating an alias to accelerate the connection
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-create-a-rsa-key-pair" title="1 - Create a RSA key pair" class="md-nav__link">
    1 - Create a RSA key pair
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-copying-your-key-to-the-server" title="2 - Copying your key to the server" class="md-nav__link">
    2 - Copying your key to the server
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-ssh-copy-id" title="Using ssh-copy-id" class="md-nav__link">
    Using ssh-copy-id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copying-the-key-manually" title="Copying the key manually" class="md-nav__link">
    Copying the key manually
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-testing-the-password-less-authentication" title="3 - Testing the password-less authentication" class="md-nav__link">
    3 - Testing the password-less authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-disabling-password-based-authentication" title="4 - Disabling password-based authentication" class="md-nav__link">
    4 - Disabling password-based authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-creating-an-alias-to-accelerate-the-connection" title="5 - Creating an alias to accelerate the connection" class="md-nav__link">
    5 - Creating an alias to accelerate the connection
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="creating-and-setting-up-a-ssh-key">Creating and setting up a SSH key<a class="headerlink" href="#creating-and-setting-up-a-ssh-key" title="Permanent link">&para;</a></h1>
<h2 id="1-create-a-rsa-key-pair">1 - Create a RSA key pair<a class="headerlink" href="#1-create-a-rsa-key-pair" title="Permanent link">&para;</a></h2>
<p>Run the following command to generate a key pair on your machine:</p>
<div class="codehilite"><pre><span></span>ssh-keygen
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can optionally use the command <code>ssh-keygen -b 4096</code> to use a higher security key.</p>
</div>
<p>You will be prompted for a location. You can use the default location (just press <code>enter</code>) or specify your own.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure you don't overwrite any existing file, because you may break an existing connection if you do.</p>
</div>
<p>You will then be prompted to enter a passphrase. This step is optional, but recommended, especially if you share your machine with other people. If you specify a passphrase, you will be prompted for it every time you use the key to login using SSH.</p>
<p>You should then have two files at your specified location: <code>id_rsa</code>, which is your <strong>private</strong> key (do NOT share with anyone) and <code>id_rsa.pub</code>, which is your <strong>public</strong> key (that you will put on your server).</p>
<h2 id="2-copying-your-key-to-the-server">2 - Copying your key to the server<a class="headerlink" href="#2-copying-your-key-to-the-server" title="Permanent link">&para;</a></h2>
<p>Now you need to copy your new key to your server. You will need either a password-based SSH account or physical access to the machine for this step. Here are two ways of doing this:</p>
<h3 id="using-ssh-copy-id">Using <code>ssh-copy-id</code><a class="headerlink" href="#using-ssh-copy-id" title="Permanent link">&para;</a></h3>
<p>If you have <code>ssh-copy-id</code> available on your system this step is easy, just run the following command:</p>
<div class="codehilite"><pre><span></span>ssh-copy-id yourusername@yourserver
</pre></div>


<p><code>yourusername</code> should be a password-based SSH account on your server.</p>
<p>If you don't have the <code>ssh-copy-id</code> utility but have ssh access to your server, you can use this one-liner to copy your key (from <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys-on-ubuntu-1804">Digital Ocean</a>): </p>
<div class="codehilite"><pre><span></span>cat ~/.ssh/id_rsa.pub <span class="p">|</span> ssh username@remote_host <span class="s2">&quot;mkdir -p ~/.ssh &amp;&amp; touch ~/.ssh/authorized_keys &amp;&amp; chmod -R go= ~/.ssh &amp;&amp; cat &gt;&gt; ~/.ssh/authorized_keys&quot;</span>
</pre></div>


<h3 id="copying-the-key-manually">Copying the key manually<a class="headerlink" href="#copying-the-key-manually" title="Permanent link">&para;</a></h3>
<p>You will need to copy the <code>id_rsa.pub</code> you have generated earlier to your server and add the contents to <code>~/.ssh/authorized_keys</code>.</p>
<p>First, you need to check if the .ssh directory exists in your home directory. You can create it using the following command:</p>
<div class="codehilite"><pre><span></span>mkdir -p ~/.ssh
</pre></div>


<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <code>mkdir -p</code> command is perfectly harmless if the directory already exists.</p>
</div>
<p>Then, you need to copy the contents of the id_rsa.pub file into a file called <code>authorized_keys</code>:</p>
<div class="codehilite"><pre><span></span>cat id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys
</pre></div>


<p>Finally, you need to make sure the permissions are right for these files:</p>
<div class="codehilite"><pre><span></span>chmod -R <span class="nv">go</span><span class="o">=</span> ~/.ssh
chown -R yourusername:yourusername ~/.ssh
</pre></div>


<p>The first command removes the permissions for anyone other than <code>yourusername</code> and the second command ensures that <code>yourusername</code> is the owner the the <code>.ssh</code> directory and all its contents. Make sure to substitute <code>yourusername</code> with the name of the actual account on your server.</p>
<h2 id="3-testing-the-password-less-authentication">3 - Testing the password-less authentication<a class="headerlink" href="#3-testing-the-password-less-authentication" title="Permanent link">&para;</a></h2>
<p>Now that everything is set-up, try to log on to your server using SSH:</p>
<div class="codehilite"><pre><span></span>ssh yourusername@yourserver
</pre></div>


<p>If your server still asks for a password (other than the private key passphrase, if using) or if it refuses the connection, please verify that you have followed all the steps above.</p>
<h2 id="4-disabling-password-based-authentication">4 - Disabling password-based authentication<a class="headerlink" href="#4-disabling-password-based-authentication" title="Permanent link">&para;</a></h2>
<p>Once you have tested that you can log on using your key, you can increase your server security by disabling password-based authentication.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Make sure that your key is working and that it is safely stored. Disabling password-based authentication will effectively lock you out of your server should you lose that key! Always make sure that you have a contingency plan!</p>
</div>
<p>Once you have tested and are able to login using only the key, you will have to edit the SSHd configuration to disable password authentication. On most linux servers, this will allow you to edit the config file:</p>
<div class="codehilite"><pre><span></span>sudo nano /etc/ssh/sshd_config
</pre></div>


<p>If that file, find and uncomment (remove the <code>#</code>) the line that says:</p>
<div class="codehilite"><pre><span></span>#PasswordAuthentication yes
</pre></div>


<p>and change it to:</p>
<div class="codehilite"><pre><span></span>PasswordAuthentication no
</pre></div>


<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>While you are in that configuration file, you should change the default port for SSH. Look for the <code>Port 22</code> directive and change it to a port &gt; 1024 for increased security. Make sure that the chosen port is not occupied by another service and that it is enabled in your firewall.</p>
</div>
<p>Save the file and restart your server to enable the changes.</p>
<h2 id="5-creating-an-alias-to-accelerate-the-connection">5 - Creating an alias to accelerate the connection<a class="headerlink" href="#5-creating-an-alias-to-accelerate-the-connection" title="Permanent link">&para;</a></h2>
<p>Now that you can login using a key, why stop there? If you have change the port on your server, the command would now be something like:</p>
<div class="codehilite"><pre><span></span>ssh -p <span class="m">2022</span> yourusername@yourserver.com
</pre></div>


<p>What if I told you that it could only be:</p>
<div class="codehilite"><pre><span></span>ssh yourserver
</pre></div>


<p>Neat, no? All you need to do is create an alias. Here's how. On your machine, run the following command:</p>
<div class="codehilite"><pre><span></span>nano ~/.ssh/config
</pre></div>


<p>In that file, type:</p>
<div class="codehilite"><pre><span></span>Host yourserver
    HostName yourserver.com
    User yourusername
    Port yourport
</pre></div>


<p><code>yourserver</code> after the <em>Host</em> directive is the name of the shortcut that your want. The <em>HostName</em> is the real domain name your your server. The <em>User</em> is the username you use to connect and the <em>Port</em> is the port you have set in step 4 (default is 22). Once you have saved the file, you should be able to connect using only <code>ssh yourserver</code>.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../.." title="Welcome" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Welcome
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 Jean-Francois Desrochers
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/jfdesrochers/itdocs" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b438e6c5.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>